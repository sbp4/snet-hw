# Домашнее задание к занятию "4.4. L4-сеть"

---

### Задание 1. 

Узел `А` отправил узлу `В` SYN-запрос.

Какова длина сегмента?

*Приведите ответ в свободной форме.*

***Ответ:***

Длина сегмента по SYN-запросу - флаг [S] - SYN (Start Connection) - равна 0. Это можно увидеть на скрине из утилиты tcpdump ниже.

<a href="https://ibb.co/kmrBcGJ"><img src="https://i.ibb.co/dm3MKft/1-1.png" alt="1-1" border="0"></a>

---

### Задание 2. 

- Узел `А` инициировал соединение с узлом `В`.
- Через некоторое время узел `А` получил `SYN`, `ACK`.

В каком TCP состоянии будет  узел `А` после получения такого ответа?

*Приведите ответ в свободной форме.*

***Ответ:***

Узел `А` после получения ответа `SYN`, `ACK` от узла `В` будет находиться в состоянии `ESTABLISHED` или `соединение установлено`.

---

### Задание 3. 

1. Может ли во флагах TCP одновременно быть установлены флаги `SYN` и `FIN` при штатном режиме работы сети?
2. Почему да или нет?

*Приведите ответ в свободной форме.*

***Ответ:***

1. При штатном режиме работы сети во флагах TCP флаги `SYN` и `FIN` не могут быть одноврененно установлены.
2. Они не могут быть одноврененно установлены потому, что будет нарушен принцип трехстороннего рукопожатия (в три этапа). По этому принципу соединение сначала устанавливается с флагом `SYN`, а после передачи данных завершается с флагом `FIN`.


---

### Задание 4. 

`ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

1. Почему в `State` присутствует только `UNCONN`?
2. Может ли там присутствовать `TIME-WAIT`?

*Приведите ответ в свободной форме.*

***Ответ:***

1. При выводе данной команды в `State` присутствует только `UNCONN` потому, что в UDP есть только два вида сокетов:
   - неприсоединенный {unconnected} сокет UDP — это сокет UDP, создаваемый по умолчанию;
   - присоединенный {connected} сокет UDP — результат вызова функции connect для сокета UDP; 
Соответственно, данная команда выводит все прослушиваемые UDP-сокеты. Так как соединения по 53 порту не установлено, сокет находится в состоянии `UNCONN`.

2. Флаг `TIME-WAIT` в данном случае присутствовать не может, так как речь идет о UDP-соединении. Данный флаг (`TIME-WAIT`) устанавливается при завершении TCP-соединения. А UDP - это протокол, который не требует обмена сообщениями и не требует предварительно установленной корреляции между двумя конечными точками.

---

### Задание 5. 

1. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии `TIME-WAIT`  ?
2. Если да, то является ли она хорошей или плохой?

Подкрепите свой ответ пояснением той или иной оценки.

*Приведите ответ в свободной форме.*

***Ответ:***

1. Теоретически, такой ситуации не должно сложиться. Так как хост, получивший флаги `FIN` и `ACK`, переходит в состояние `TIME-WAIT`. Это состояние характеризуется параметром MSL или Maximum Segment Lifetime. В RFC 793 timeout `TIME-WAIT` задан как 2MSL. В моей установленной ВМ по умолчанию параметр tcp_fin_timeout = 60 секундам. Соответственно, через 60 секунд соединение из `TIME-WAIT` должно перейти в состояние `CLOSED`. Возможно, такая ситуация будет иметь место на высоконагруженном сервере, к которому за единицу времени будет совершено большое количество обращений.

<a href="https://ibb.co/CPrGtK5"><img src="https://i.ibb.co/cYmnvhc/5-1.png" alt="5-1" border="0"></a>

2. Если данная ситуация возникнет на высоконагруженном сервере, предположу, что ничего хорошего она не принесет. По сути, сервер начнет подтормаживать. 

---

**

## Дополнительные задания (со звездочкой*)
Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.


### Задание 6. 

Если бы вы строили систему удаленного сбора логов, какой протокол транспортного уровня вы выбрали бы и почему?

_Примечение:_ 
- Система удаленного сбора логов - система, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи.  Предположим, что логи – текстовая информация. 
- Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе `syslog`.

*Приведите ответ в свободной форме.*

***Ответ:***

Если бы я строили систему удаленного сбора логов, я бы использовал протокол TCP, так как он обеспечивает:
- надежную доставку данных;
- сборку сегментов на стороне получателя;
- контроль сессии;
- контроль скорости передачи данных.
Данные параметры необходимы в системе логирования, так как сама система играет важную роль в обеспечении бесперебойной и безопасной работы всей IT-инфраструктуры. 

Syslog - отличный способ объединить логи из нескольких источников в одном месте. Протокол `syslog` по умолчанию собирает данные по протоколу UDP на 514 порте. Однако, так как UDP-сообщения не подтверждаются и не гарантируются, некоторые сетевые устройства отправляют данные Syslog через 1468 TCP порт для обеспечения доставки сообщений. 

---

### Задание 7. 

1. Сколько портов TCP находится в состоянии прослушивания на вашей машине (физической или виртуальной)?
2. Каким процессам они принадлежат?
3. Какой командой вы это узнавали?

*Приведите ответ в свободной форме.*

***Ответ:***

1. На момент запроса находилось 10 TCP портов в состоянии прослушивания;
2. 5 - 1881 (browser), 1 - 4296 (telnet), 2 - 4560 (ftp);
3. Команда: `lsof -ni tcp`

<a href="https://ibb.co/CmFhsF7"><img src="https://i.ibb.co/sbryJrw/7-1.png" alt="7-1" border="0"></a>
