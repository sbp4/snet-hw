# Домашнее задание к занятию "4.8. Траблшутинг"

---

### Задание 1. 

1. Укажите путь к файлам логов веб-сервера `Nginx`. 
2. Где находится конфигурационный файл, в котором можно посмотреть / поменять эти пути?
3. Какой командой можно воспользоваться для просмотра файла журнала в режиме реального времени?
Попробуйте найти сами, либо воспользуйтесь [ссылкой](https://andreyex.ru/operacionnaya-sistema-linux/nastrojka-zhurnala-oshibok-i-dostupa-nginx/).

*Приведите ответ в свободной форме.*

***Ответ:***

1. /var/log/nginx/access.log: регистрирует все запросы, полученные веб-сервером `Nginx` (если не настроено другое поведение)
   /var/log/nginx/error.log: хранит все сообщения об ошибках `Nginx`

2. /etc/nginx/nginx.conf: главный конфигурационный файл `Nginx`, содержащий глобальные настройки веб-сервера. В этом файле в разделе "Logging Settings" можно посмотреть/поменять пути к файлам логов `Nginx`

3. cd /var/log/nginx - для перехода к файлам логов
   tail -f access.log - для просмотра файла журнала в режиме реального времени

---

### Задание 2. 

Познакомьтесь со схемой сети.

![](https://i.imgur.com/RefFHYj.png)

1. `COMP1` не может обменяться данными с `COMP4`. Какую последовательность действий вы выберете для того, чтобы локализовать проблему?
2. Возможно ли, чтобы при выполнении `ping 192.168.1.2` с компьютера `COMP5`, `ping` прошёл, а подключение по HTTP с `COMP5` на `COMP1` не проходило бы? Поясните свой  ответ максимально детально.
3. `COMP5` отправляет `ping` на `COMP1` и `COMP2`, при этом `COMP1` на `ping` отвечает, а `COMP2` - нет. 

Приведите максимальное количество причин. Самую простую, но нередко встречающуюся - «У `COMP2` выдернули кабель питания» - я уже ответил за вас.

4. `COMP1` пингует только адреса из подсети `192.168.1.0/24` (`COMP2` и `192.168.1.1`), больше никакие адреса не пингуются. С чем это может быть связано? 

*Приведите ответ в свободной форме.*

***Ответ:***

1. - проверка на физическом уровне (L1) - наличие отключения или повреждения кабеля;
   - проверка линка или connectivity (L1, L2) - порт на оборудовании может быть не настроен, заблокирован или отключен;
   - проверка корректности настройки соеднинения (L2, L3, L4) - некорректный ip-адрес, маршрут, шлюз, блокировка на строне firewall'a;
   - проверка корректности работы ПО (L5-L7) - несоответствие версий ПО, выключенное ПО, неправильно настроенный порт, и т.д.;
   - проверка загруженности канала - возможно кто-то решил выкачать все сезоны "Игры престолов" с торрента и положить сеть;
   - проблемы на строне провайдера - созвон с провайдером, уточнение ситуации.

2. Такая ситуация более чем возможна. Если пинги проходят, значит компьютер работает и может ответить на запросы. Но если подключение по HTTP не проходит, тогда это свидетельствует о наличие проблем на уровне L5-L7. Иными словами, некорректно настроена работа ПО. Здесь можно говорить о том, что: 
   - сервис вообще не установлен;
   - сервис установлен, но не запущен;
   - сервис установлен, запущен, но блокируется firewall'ом;
   - сервис установлен, запущен, но отвечает по другому порту (к примеру 8080);
   - сервис установлен, запущен, отвечает по 80 порту, но доступ настроен только с определенных IP-адресов  и т.д.;

3. Причины:
   - к компьютеру `COMP2` не подключен сетевой кабель;
   - на маршрутизаторе заблокирован/не настроен/отключен порт, к которому подключен `COMP2`;
   - на компьютере `COMP2` некорректно настроено подключение: прописан некорректный ip-адрес,  настроена некорректная маршрутизация, прописан 
     некорректный шлюз или вообще не прописан, ICMP заблокирован firewall'ом;

4. Это свяязано с тем, что на `COMP1` в настройках линка не прописан параметр `Gateway`. Соответственно, все запросы, отправляемые на адреса, вне диапазона сети `192.168.1.0/24` теряются, так как не могут найти маршрут до адресата.

---


**

## Дополнительные задания (со звездочкой*)
Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.


### Задание 3. 

Используя схему из Задания 2, попробуйте ответить на вопросы:
1. `COMP1` и `COMP2` оба пингуют `10.1.1.2`, однако не пингуют `192.168.2.1` и прочие адреса из `192.168.2.0/24`. Как вы думаете, что не так и как это можно исправить?
2. Какими способами мы можем сделать так, чтобы `COMP2` не смог общаться ни с кем кроме своей локальной сети? (Приведите вариант с настройками самого `COMP2` и попробуйте придумать, можно ли что-то сделать на маршрутизаторе `192.168.1.1`)
3. Как вы думаете, что будет происходить при попытке провести `ping` с `COMP5` на `192.168.2.3` ?

*Приведите ответ в свободной форме.*

***Ответ:***

1. На маршрутизаторе `10.1.1.2` не настроен статический NAT. Его включение исправит ситуацию и сеть `192.168.2.0/24` запингуется.

2. Этого можно добиться не указывая gateway в настройках подключения `COMP2`. Вариант настроек `COMP2` в конфиге /etc/network/interfaces:
   
   # The network interface
   auto enp0s3
   iface enp0s3 inet static 
   address 192.168.1.3 
   netmask 255.255.255.0

Кроме этого, на маршрутизаторе `192.168.1.1` можно отключить NAT, тогда вся сеть станет изолированной.

3. Возможны варианты). Если один из двух компов - `COMP3` или `COMP4` - выключен, тогда пинги пройдут к включенному компу. Если оба компьютера будут включены, возникнет конфликт ip-адресов, при котором адрес `192.168.2.3` будет недоступен, соответственно, пинги не смогут пройти. 

---

### Задание 4. 

- Сделайте `ping` с одной виртуальной / физической машины на другую.
- Используя [описание утилиты iperf](https://losst.ru/kak-polzovatsya-iperf), загрузите канал между двумя виртуальными машинами на максимум, например, на 60 секунд, в процессе загрузки повторите `ping`.
- Изменились ли цифры в ответе команды `ping`? Почему? Есть ли разница между физическими и виртуальными машинами?

*Приведите скриншоты/ответы команд до и во время высокой загрузки каналов.*

***Ответ:***

- `ping` с виртуальной машины vm1 на виртуальную машину vm2

<a href="https://ibb.co/98N0r2r"><img src="https://i.ibb.co/FxK1DJD/4-1.png" alt="4-1" border="0"></a>

- `ping` с физической машины (notebook) на виртуальную машину vm2

<a href="https://ibb.co/cN4D6st"><img src="https://i.ibb.co/ZhqWBbK/4-2.png" alt="4-2" border="0"></a>

- запуск iperf3 клиента и сервера

<a href="https://ibb.co/Gc6WNL3"><img src="https://i.ibb.co/J51vg4F/4-3.png" alt="4-3" border="0"></a>

<a href="https://ibb.co/zbpXPKT"><img src="https://i.ibb.co/pZcf4CB/4-4.png" alt="4-4" border="0"></a>

- `ping` с виртуальной машины vm1 на виртуальную машину vm2 в процессе загрузки канала

<a href="https://ibb.co/QMjFgBC"><img src="https://i.ibb.co/L1hzFwJ/4-5.png" alt="4-5" border="0"></a>

- `ping` с физической машины (notebook) на виртуальную машину vm2 в процессе загрузки канала

<a href="https://ibb.co/kMyS6bm"><img src="https://i.ibb.co/BwPCKWn/4-6.png" alt="4-6" border="0"></a>

Вывод: цифры в ответе команды `ping`, на моем тестовом стенде, сильно не изменились, ответ в пределах миллисекунды. Дальнейшее тестирование, с увеличением интервала загрузки канала до 6 минут, выявило небольшие увеличения времени ответа по пингу до 1,5 - 6 миллисекунд. Это свидетельствует, что загрузка канала может повлиять на увеличение времени ответа по пингу. А вот разницы в работе команды на физической и виртуальной машине на моем тестовом стенде я не заметил.